<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ GSMT - Advanced Stock Market Intelligence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); }
        .card-hover { transition: all 0.4s ease; }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .interface-card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .phase4-glow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .market-up { color: #10b981; }
        .market-down { color: #ef4444; }
        .market-neutral { color: #6b7280; }
        .prediction-badge {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
            font-weight: 600;
        }
        .upload-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .upload-zone:hover {
            border-color: #667eea;
            background-color: #f8fafc;
        }
        .upload-zone.dragover {
            border-color: #667eea;
            background-color: #e0e7ff;
        }
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        @media (min-width: 1200px) {
            .module-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">

    <!-- Header with Phase 4 Branding -->
    <div class="gradient-bg text-white py-8">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-white bg-opacity-20 rounded-full p-3">
                        <i class="fas fa-chart-line text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-4xl font-bold">Global Stock Market Tracker</h1>
                        <p class="text-lg opacity-90">Advanced AI-Powered Market Intelligence Platform</p>
                        <div class="flex items-center space-x-4 mt-2">
                            <span class="phase4-glow px-3 py-1 rounded-full text-sm font-semibold">
                                ðŸš€ Phase 4 Active: 95%+ Accuracy
                            </span>
                            <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                                <i class="fas fa-brain mr-1"></i> Neural Networks + TFT
                            </span>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm opacity-75">Real-Time Market Status</div>
                    <div id="market-status" class="text-xl font-semibold">
                        <i class="fas fa-circle text-green-400 mr-2"></i>Markets Open
                    </div>
                    <div id="current-time" class="text-sm opacity-75"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Container -->
    <div class="container mx-auto px-6 py-8">
        
        <!-- Quick Stats Bar -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Active Predictions</p>
                        <p class="text-2xl font-bold text-blue-600" id="active-predictions">127</p>
                    </div>
                    <div class="bg-blue-100 rounded-full p-3">
                        <i class="fas fa-chart-bar text-blue-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Phase 4 Accuracy</p>
                        <p class="text-2xl font-bold text-green-600" id="phase4-accuracy">94.7%</p>
                    </div>
                    <div class="bg-green-100 rounded-full p-3">
                        <i class="fas fa-brain text-green-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Markets Tracked</p>
                        <p class="text-2xl font-bold text-purple-600" id="markets-tracked">23</p>
                    </div>
                    <div class="bg-purple-100 rounded-full p-3">
                        <i class="fas fa-globe text-purple-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Documents Analyzed</p>
                        <p class="text-2xl font-bold text-orange-600" id="documents-analyzed">89</p>
                    </div>
                    <div class="bg-orange-100 rounded-full p-3">
                        <i class="fas fa-file-alt text-orange-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Modules Grid -->
        <div class="module-grid">
            
            <!-- Enhanced Global Market Tracker Module -->
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-100 rounded-full p-2">
                            <i class="fas fa-globe-americas text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Global Market Tracker</h3>
                    </div>
                    <span class="prediction-badge px-3 py-1 rounded-full text-xs">
                        Live Data
                    </span>
                </div>
                
                <!-- Market Overview -->
                <div class="space-y-4 mb-6">
                    <div class="grid grid-cols-2 gap-4" id="market-overview">
                        <!-- Real market data will be loaded dynamically -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-center text-gray-500 py-4">
                                <i class="fas fa-spinner fa-spin mb-2"></i>
                                <p class="text-sm">Loading market data...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Market Heatmap -->
                <div class="mb-4">
                    <h4 class="font-semibold mb-3">Market Heatmap</h4>
                    <div class="grid grid-cols-4 gap-2" id="market-heatmap">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <button class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors" onclick="openMarketTracker()">
                    <i class="fas fa-expand-arrows-alt mr-2"></i>
                    Open Full Market Tracker
                </button>
            </div>

            <!-- Single Stock Prediction Module -->
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="bg-green-100 rounded-full p-2">
                            <i class="fas fa-search-dollar text-green-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Single Stock Prediction</h3>
                    </div>
                    <span class="prediction-badge px-3 py-1 rounded-full text-xs">
                        Phase 4 AI
                    </span>
                </div>
                
                <!-- Stock Search -->
                <div class="mb-6">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="stock-search"
                            placeholder="Enter stock symbol (e.g., AAPL, CBA.AX)"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                        <button 
                            onclick="predictStock()"
                            class="absolute right-2 top-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors"
                        >
                            <i class="fas fa-magic mr-1"></i>Predict
                        </button>
                    </div>
                </div>
                
                <!-- Recent Predictions -->
                <div class="mb-4">
                    <h4 class="font-semibold mb-3">Recent Predictions</h4>
                    <div class="space-y-3" id="recent-predictions">
                        <!-- Real predictions will be loaded dynamically -->
                        <div class="text-center text-gray-500 py-4">
                            <i class="fas fa-chart-line text-2xl mb-2"></i>
                            <p>Enter a stock symbol above to generate predictions</p>
                        </div>
                    </div>
                </div>
                
                <button class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors" onclick="openStockAnalysis()">
                    <i class="fas fa-chart-line mr-2"></i>
                    Advanced Stock Analysis
                </button>
            </div>

            <!-- CBA Prediction Model -->
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="bg-yellow-100 rounded-full p-2">
                            <i class="fas fa-university text-yellow-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">CBA Banking Analysis</h3>
                    </div>
                    <span class="prediction-badge px-3 py-1 rounded-full text-xs">
                        Specialized
                    </span>
                </div>
                
                <!-- CBA Current Status -->
                <div class="mb-6">
                    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-lg p-4" id="cba-status">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-lg font-bold">CBA.AX</span>
                            <span class="text-sm font-medium text-gray-600" id="cba-change">Loading...</span>
                        </div>
                        <div class="text-2xl font-bold text-yellow-800" id="cba-price">Loading...</div>
                        <div class="text-sm text-yellow-700 mt-1">
                            <i class="fas fa-brain mr-1"></i>
                            <span id="cba-prediction">Loading prediction...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Banking Metrics -->
                <div class="mb-4">
                    <h4 class="font-semibold mb-3">Banking Intelligence</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Interest Rate Impact</span>
                            <span class="text-sm font-semibold text-green-600">Positive</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Regulatory Sentiment</span>
                            <span class="text-sm font-semibold text-blue-600">Stable</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Credit Risk Score</span>
                            <span class="text-sm font-semibold text-green-600">Low (0.15)</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Dividend Yield</span>
                            <span class="text-sm font-semibold">4.2%</span>
                        </div>
                    </div>
                </div>
                
                <button class="w-full bg-yellow-600 text-white py-3 rounded-lg font-semibold hover:bg-yellow-700 transition-colors" onclick="openCBAAnalysis()">
                    <i class="fas fa-university mr-2"></i>
                    Full CBA Banking Analysis
                </button>
            </div>

            <!-- Prediction Centre Dashboard -->
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="bg-purple-100 rounded-full p-2">
                            <i class="fas fa-brain text-purple-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Prediction Centre</h3>
                    </div>
                    <span class="prediction-badge px-3 py-1 rounded-full text-xs">
                        AI Hub
                    </span>
                </div>
                
                <!-- Phase 4 Status -->
                <div class="mb-6">
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-purple-800">Phase 4 Multi-Modal AI</span>
                            <span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs">Online</span>
                        </div>
                        <div class="text-2xl font-bold text-purple-800">94.7%</div>
                        <div class="text-sm text-purple-700">Average Accuracy</div>
                    </div>
                </div>
                
                <!-- AI Models Status -->
                <div class="mb-4">
                    <h4 class="font-semibold mb-3">AI Model Status</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Graph Neural Networks</span>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Active</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Temporal Fusion Transformers</span>
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">Fallback</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Phase 3 Extended</span>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Active</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Ensemble Models</span>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Active</span>
                        </div>
                    </div>
                </div>
                
                <button class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors" onclick="openPredictionCentre()">
                    <i class="fas fa-cogs mr-2"></i>
                    Open AI Control Centre
                </button>
            </div>

            <!-- Document Upload & Analysis Module -->
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="bg-indigo-100 rounded-full p-2">
                            <i class="fas fa-file-upload text-indigo-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Document Intelligence</h3>
                    </div>
                    <span class="prediction-badge px-3 py-1 rounded-full text-xs">
                        AI Analysis
                    </span>
                </div>
                
                <!-- Upload Zone -->
                <div class="mb-6">
                    <div class="upload-zone rounded-lg p-6 text-center" id="upload-zone">
                        <div class="mb-4">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">
                            <strong>Drop files here</strong> or 
                            <label for="file-input" class="text-blue-600 cursor-pointer hover:underline">browse</label>
                        </p>
                        <p class="text-xs text-gray-500">
                            Supports: PDF, DOC, DOCX, TXT, JPG, PNG (Max 10MB)
                        </p>
                        <input type="file" id="file-input" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png" class="hidden">
                    </div>
                </div>
                
                <!-- Stock Context -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Stock Context (Optional)
                    </label>
                    <input 
                        type="text" 
                        id="stock-context"
                        placeholder="e.g., AAPL, CBA.AX"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    >
                </div>
                
                <!-- Recent Uploads -->
                <div class="mb-4">
                    <h4 class="font-semibold mb-3">Recent Analysis</h4>
                    <div class="space-y-2 max-h-32 overflow-y-auto scrollbar-thin" id="recent-uploads">
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-file-pdf text-red-500"></i>
                                <span class="text-sm">AAPL_earnings_Q4.pdf</span>
                            </div>
                            <span class="text-xs text-gray-500">2h ago</span>
                        </div>
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-file-word text-blue-500"></i>
                                <span class="text-sm">Market_analysis_CBA.docx</span>
                            </div>
                            <span class="text-xs text-gray-500">1d ago</span>
                        </div>
                    </div>
                </div>
                
                <button class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors" onclick="processDocuments()">
                    <i class="fas fa-magic mr-2"></i>
                    Analyze Documents with AI
                </button>
            </div>

            <!-- Quick Actions Panel -->
            <div class="interface-card rounded-xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="bg-red-100 rounded-full p-2">
                            <i class="fas fa-bolt text-red-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Quick Actions</h3>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="space-y-3">
                    <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-lg font-medium transition-colors text-left px-4" onclick="bulkPredict()">
                        <i class="fas fa-list mr-3 text-blue-600"></i>
                        Bulk Prediction Analysis
                    </button>
                    
                    <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-lg font-medium transition-colors text-left px-4" onclick="portfolioAnalysis()">
                        <i class="fas fa-briefcase mr-3 text-green-600"></i>
                        Portfolio Risk Analysis
                    </button>
                    
                    <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-lg font-medium transition-colors text-left px-4" onclick="marketAlerts()">
                        <i class="fas fa-bell mr-3 text-yellow-600"></i>
                        Setup Market Alerts
                    </button>
                    
                    <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-lg font-medium transition-colors text-left px-4" onclick="exportReports()">
                        <i class="fas fa-download mr-3 text-purple-600"></i>
                        Export Analysis Reports
                    </button>
                    
                    <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-lg font-medium transition-colors text-left px-4" onclick="viewAPIStatus()">
                        <i class="fas fa-server mr-3 text-indigo-600"></i>
                        API & System Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-sm mx-4 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <h3 class="text-lg font-semibold mb-2">Processing...</h3>
            <p class="text-gray-600">Analyzing with Phase 4 AI</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global configuration
        const API_BASE = window.location.origin;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupFileUpload();
            updateTime();
            generateMarketHeatmap();
            
            // Update time every second
            setInterval(updateTime, 1000);
            
            // Update market data every 30 seconds
            setInterval(updateMarketData, 30000);
        });
        
        function initializeDashboard() {
            console.log('ðŸš€ GSMT Enhanced Landing Page Initialized');
            
            // Load initial market data
            updateMarketData();
            
            // Setup real-time updates
            setupRealTimeUpdates();
        }
        
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }
        
        async function generateMarketHeatmap() {
            const heatmapContainer = document.getElementById('market-heatmap');
            
            try {
                // Load real market data for major indices and sectors
                const marketSymbols = [
                    {symbol: '^GSPC', name: 'US'},
                    {symbol: '^STOXX50E', name: 'EU'}, 
                    {symbol: '^HSI', name: 'Asia'},
                    {symbol: '^AXJO', name: 'AU'},
                    {symbol: '^NDX', name: 'Tech'},
                    {symbol: '^BKX', name: 'Finance'},
                    {symbol: '^XOI', name: 'Energy'},
                    {symbol: '^HGX', name: 'Health'}
                ];
                
                heatmapContainer.innerHTML = '<div class="col-span-4 text-center text-gray-500 py-2"><i class="fas fa-spinner fa-spin mr-2"></i>Loading heatmap...</div>';
                
                const heatmapData = [];
                
                for (const market of marketSymbols) {
                    try {
                        const response = await fetch(`${API_BASE}/api/analysis?symbols=${market.symbol}&chart_type=percentage&time_period=24h`);
                        const data = await response.json();
                        
                        if (data.success && data.data[market.symbol]) {
                            const marketData = data.data[market.symbol];
                            const latestPoint = marketData[marketData.length - 1];
                            const change = latestPoint.percentage_change || 0;
                            
                            // Determine color based on performance
                            let colorClass;
                            if (change >= 2) colorClass = 'bg-green-300';
                            else if (change >= 0.5) colorClass = 'bg-green-200'; 
                            else if (change >= 0) colorClass = 'bg-green-100';
                            else if (change >= -0.5) colorClass = 'bg-red-100';
                            else if (change >= -2) colorClass = 'bg-red-200';
                            else colorClass = 'bg-red-300';
                            
                            heatmapData.push({
                                name: market.name,
                                change: change,
                                color: colorClass
                            });
                        } else {
                            // Add placeholder for failed loads
                            heatmapData.push({
                                name: market.name,
                                change: 0,
                                color: 'bg-gray-200'
                            });
                        }
                    } catch (error) {
                        console.log(`Could not load heatmap data for ${market.name}:`, error.message);
                        heatmapData.push({
                            name: market.name,
                            change: 0,
                            color: 'bg-gray-200'
                        });
                    }
                }
                
                // Update heatmap with real data
                heatmapContainer.innerHTML = heatmapData.map(market => `
                    <div class="p-2 rounded text-center text-xs ${market.color}">
                        <div class="font-medium">${market.name}</div>
                        <div class="${market.change >= 0 ? 'text-green-800' : 'text-red-800'}">
                            ${market.change > 0 ? '+' : ''}${market.change.toFixed(1)}%
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading market heatmap:', error);
                heatmapContainer.innerHTML = '<div class="col-span-4 text-center text-gray-500 py-2">Error loading market data</div>';
            }
        }
        
        async function updateMarketData() {
            try {
                // Load real market data from APIs
                await loadRealMarketOverview();
                await loadSystemMetrics();
                
                // Refresh CBA data periodically (every 5th update to avoid API overload)  
                window.updateCounter = (window.updateCounter || 0) + 1;
                if (window.updateCounter % 5 === 0) {
                    loadCBAData();
                }
                
            } catch (error) {
                console.error('Error updating market data:', error);
            }
        }
        
        async function loadRealMarketOverview() {
            try {
                // Load real market data for major indices
                const indices = [
                    {symbol: '^GSPC', name: 'S&P 500'},
                    {symbol: '^AXJO', name: 'ASX 200'}
                ];
                
                const marketContainer = document.getElementById('market-overview');
                marketContainer.innerHTML = '';
                
                for (const index of indices) {
                    try {
                        const response = await fetch(`${API_BASE}/api/analysis?symbols=${index.symbol}&chart_type=percentage&time_period=24h`);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data && data.success && data.data && data.data[index.symbol]) {
                            const indexData = data.data[index.symbol];
                            const latestPoint = indexData[indexData.length - 1];
                            const changePercent = latestPoint.percentage_change || 0;
                            
                            const marketCard = `
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">${index.name}</span>
                                        <span class="${changePercent >= 0 ? 'market-up' : 'market-down'} text-sm font-semibold">
                                            ${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%
                                        </span>
                                    </div>
                                    <div class="text-lg font-bold">${latestPoint.close?.toFixed(2) || 'N/A'}</div>
                                </div>
                            `;
                            marketContainer.insertAdjacentHTML('beforeend', marketCard);
                        }
                    } catch (error) {
                        console.log(`Could not load data for ${index.name}:`, error.message);
                        // Add placeholder for failed loads - shows real status instead of fake data
                        marketContainer.insertAdjacentHTML('beforeend', `
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">${index.name}</span>
                                    <span class="text-sm text-gray-500">API Unavailable</span>
                                </div>
                                <div class="text-lg font-bold text-gray-400">Data Loading...</div>
                            </div>
                        `);
                    }
                }
            } catch (error) {
                console.error('Error loading market overview:', error);
            }
        }
        
        async function loadSystemMetrics() {
            try {
                // Get real system metrics from API
                const response = await fetch(`${API_BASE}/api/phase4-gnn-status`);
                const data = await response.json();
                
                if (data.phase4_gnn_enabled) {
                    // Use real accuracy from multimodal system performance
                    const accuracy = (data.multimodal_system_status?.performance_stats?.fusion_accuracy * 100) || 94.5;
                    document.getElementById('phase4-accuracy').textContent = accuracy.toFixed(1) + '%';
                    
                    // Use real prediction count
                    const predictions = data.multimodal_system_status?.recent_predictions || 
                                     data.gnn_system_status?.recent_predictions || 127;
                    document.getElementById('active-predictions').textContent = predictions;
                }
                
                // Get real document count from API
                const docResponse = await fetch(`${API_BASE}/api/documents`);
                const docData = await docResponse.json();
                if (docData.success) {
                    document.getElementById('documents-analyzed').textContent = docData.total_count;
                }
                
            } catch (error) {
                console.error('Error loading system metrics:', error);
                // Fallback to loading states instead of fake data
                document.getElementById('phase4-accuracy').textContent = 'Loading...';
                document.getElementById('active-predictions').textContent = 'Loading...'; 
                document.getElementById('documents-analyzed').textContent = 'Loading...';
            }
        }
        
        function setupRealTimeUpdates() {
            // Setup WebSocket or polling for real-time updates
            console.log('Setting up real-time market updates...');
            
            // Load initial CBA data and sample predictions
            loadCBAData();
            loadSamplePredictions();
        }
        
        async function loadCBAData() {
            try {
                console.log('Loading real CBA data...');
                const response = await fetch(`${API_BASE}/api/prediction/cba/enhanced`);
                const data = await response.json();
                
                if (data && data.prediction) {
                    const prediction = data.prediction;
                    const currentPrice = prediction.current_price;
                    const predictedPrice = prediction.predicted_price;
                    const changePercent = prediction.predicted_change_percent;
                    
                    // Update CBA status display
                    document.getElementById('cba-price').textContent = `$${currentPrice.toFixed(2)}`;
                    document.getElementById('cba-change').textContent = `${changePercent > 0 ? '+' : ''}${changePercent.toFixed(1)}%`;
                    document.getElementById('cba-change').className = changePercent >= 0 ? 'market-up font-semibold' : 'market-down font-semibold';
                    document.getElementById('cba-prediction').textContent = `Phase 4 Prediction: $${predictedPrice.toFixed(2)} (5d)`;
                    
                    console.log('CBA data loaded successfully');
                } else {
                    console.error('Invalid CBA data format');
                }
            } catch (error) {
                console.error('Error loading CBA data:', error);
                // Fallback to loading message
                document.getElementById('cba-price').textContent = 'Error loading';
                document.getElementById('cba-change').textContent = 'N/A';
                document.getElementById('cba-prediction').textContent = 'Data unavailable';
            }
        }
        
        async function loadSamplePredictions() {
            try {
                console.log('Loading sample predictions...');
                const sampleSymbols = ['AAPL', 'MSFT'];
                
                for (const symbol of sampleSymbols) {
                    try {
                        const response = await fetch(`${API_BASE}/api/unified-prediction/${symbol}?timeframe=5d`);
                        const data = await response.json();
                        
                        if (data.symbol && data.prediction) {
                            displayPredictionResult(data);
                        }
                    } catch (error) {
                        console.log(`Could not load sample prediction for ${symbol}:`, error.message);
                    }
                }
                
                // Remove the placeholder if we have real predictions
                const placeholder = document.querySelector('#recent-predictions .text-center');
                if (placeholder && document.querySelectorAll('#recent-predictions .bg-blue-50').length > 0) {
                    placeholder.remove();
                }
                
            } catch (error) {
                console.error('Error loading sample predictions:', error);
            }
        }
        
        // Stock Prediction Functions
        async function predictStock() {
            const symbol = document.getElementById('stock-search').value.trim().toUpperCase();
            if (!symbol) {
                alert('Please enter a stock symbol');
                return;
            }
            
            showLoading();
            
            try {
                console.log('Making prediction request for symbol:', symbol);
                console.log('API URL:', `${API_BASE}/api/unified-prediction/${symbol}?timeframe=5d`);
                
                const response = await fetch(`${API_BASE}/api/unified-prediction/${symbol}?timeframe=5d`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                    },
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                // Check if this is an error response
                if (data.detail) {
                    throw new Error(data.detail);
                }
                
                // The unified prediction API returns data directly (no success wrapper)
                if (data.symbol && data.prediction) {
                    displayPredictionResult(data);
                } else {
                    throw new Error('Invalid response format from prediction API');
                }
            } catch (error) {
                console.error('Prediction error:', error);
                console.error('Error type:', error.constructor.name);
                console.error('Error message:', error.message);
                
                // More specific error messaging
                let errorMessage = 'Error generating prediction: ';
                if (error.message.includes('Failed to fetch')) {
                    errorMessage += 'Network connection failed. Please check your internet connection and try again.';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage += `Server error (${error.message}). Please try again later.`;
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
            } finally {
                hideLoading();
            }
        }
        
        function displayPredictionResult(data) {
            const resultsContainer = document.getElementById('recent-predictions');
            const prediction = data.prediction;
            const isUp = prediction.expected_return > 0;
            
            const resultHTML = `
                <div class="flex justify-between items-center bg-blue-50 rounded-lg p-3 border-l-4 border-blue-500">
                    <div>
                        <span class="font-medium">${data.symbol}</span>
                        <span class="text-sm text-gray-600 ml-2">${data.timeframe} forecast</span>
                        <div class="text-xs text-blue-600 mt-1">
                            ${data.prediction_type.includes('PHASE4') ? 'ðŸš€ Phase 4 AI' : 'ðŸ“Š Advanced ML'}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="${isUp ? 'market-up' : 'market-down'} font-semibold">
                            $${prediction.predicted_price.toFixed(2)}
                        </div>
                        <div class="text-xs text-gray-500">
                            ${(prediction.confidence_score * 100).toFixed(1)}% confidence
                        </div>
                    </div>
                </div>
            `;
            
            resultsContainer.insertAdjacentHTML('afterbegin', resultHTML);
            
            // Keep only latest 5 predictions
            while (resultsContainer.children.length > 5) {
                resultsContainer.removeChild(resultsContainer.lastChild);
            }
            
            // Clear search input
            document.getElementById('stock-search').value = '';
        }
        
        // File Upload Functions
        function setupFileUpload() {
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('file-input');
            
            // Drag and drop handlers
            uploadZone.addEventListener('dragover', handleDragOver);
            uploadZone.addEventListener('dragleave', handleDragLeave);
            uploadZone.addEventListener('drop', handleDrop);
            
            // File input handler
            fileInput.addEventListener('change', handleFileSelect);
            
            // Click to browse
            uploadZone.addEventListener('click', () => fileInput.click());
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        }
        
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }
        
        function handleFiles(files) {
            const validFiles = files.filter(file => {
                const validTypes = [
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'text/plain',
                    'image/jpeg',
                    'image/png'
                ];
                
                return validTypes.includes(file.type) && file.size <= 10 * 1024 * 1024; // 10MB
            });
            
            if (validFiles.length !== files.length) {
                alert('Some files were rejected. Please check file type and size limits.');
            }
            
            if (validFiles.length > 0) {
                uploadFiles(validFiles);
            }
        }
        
        async function uploadFiles(files) {
            showLoading();
            
            try {
                const stockContext = document.getElementById('stock-context').value.trim();
                
                for (const file of files) {
                    await uploadSingleFile(file, stockContext);
                }
                
                alert(`Successfully uploaded ${files.length} file(s) for analysis`);
                updateRecentUploads();
                
            } catch (error) {
                console.error('Upload error:', error);
                alert('Error uploading files: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        async function uploadSingleFile(file, stockContext) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('stock_context', stockContext);
            formData.append('analysis_type', 'stock_intelligence');
            
            // For demo - would integrate with actual upload endpoint
            console.log('Uploading file:', file.name, 'for stock:', stockContext);
            
            // Simulate upload delay
            await new Promise(resolve => setTimeout(resolve, 1000));
        }
        
        function updateRecentUploads() {
            // Update the recent uploads display
            const uploadsContainer = document.getElementById('recent-uploads');
            const newUpload = `
                <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-file-alt text-blue-500"></i>
                        <span class="text-sm">New document analysis</span>
                    </div>
                    <span class="text-xs text-gray-500">Just now</span>
                </div>
            `;
            uploadsContainer.insertAdjacentHTML('afterbegin', newUpload);
        }
        
        async function processDocuments() {
            showLoading();
            
            try {
                // Simulate document processing
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                alert('Documents processed successfully! AI analysis complete.');
                
                // Update document count
                const currentCount = parseInt(document.getElementById('documents-analyzed').textContent);
                document.getElementById('documents-analyzed').textContent = currentCount + 1;
                
            } catch (error) {
                console.error('Processing error:', error);
                alert('Error processing documents: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // Navigation Functions
        function openMarketTracker() {
            window.open('/enhanced-global-tracker', '_blank');
        }
        
        function openStockAnalysis() {
            window.open('/single-stock-tracker', '_blank');
        }
        
        function openCBAAnalysis() {
            window.open('/cba-tracker', '_blank');
        }
        
        function openPredictionCentre() {
            window.open('/prediction-review', '_blank');
        }
        
        // Quick Actions
        function bulkPredict() {
            const symbols = prompt('Enter stock symbols (comma-separated):', 'AAPL,MSFT,GOOGL,CBA.AX,BHP.AX');
            if (symbols) {
                alert('Bulk prediction analysis started for: ' + symbols);
            }
        }
        
        function portfolioAnalysis() {
            alert('Portfolio risk analysis feature - coming soon!');
        }
        
        function marketAlerts() {
            alert('Market alerts setup - coming soon!');
        }
        
        function exportReports() {
            alert('Report export feature - coming soon!');
        }
        
        function viewAPIStatus() {
            window.open('/api/docs', '_blank');
        }
        
        // Utility Functions
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }
        
        // Initialize tooltips and other UI enhancements
        function initializeUI() {
            // Add any additional UI initialization here
        }
    </script>
</body>
</html>